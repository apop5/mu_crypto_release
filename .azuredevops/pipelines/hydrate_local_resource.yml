# File hydrate_local_resource.yml
#
# This template function will clone a single resource to a designated
# path, and initialize whatever other config is needed to incorporate
# the resource into the build.
#
# Copyright (C) Microsoft Corporation
# SPDX-License-Identifier: BSD-2-Clause-Patent
##

parameters:
- name: resource_name
  displayName: Resource Name
  type: string

steps:
- checkout: ${{ parameters.resource_name }}
  displayName: Hydrate ${{ parameters.resource_name }}
  # This path is relative to $(Agent.BuildDirectory)
  # See: https://docs.microsoft.com/en-us/azure/devops/pipelines/repos/multi-repo-checkout?view=azure-devops#checkout-path
  path: repos/${{parameters.resource_name }}

# TODO: Right here is where we would normally save the substitution path to the config file.
#       Instead, we'll directly update the URL.
- bash:
  # displayName:
  inputs:
    targetType: inline
    script: |
      git -C . submodule set-url -- MU_BASECORE $(Agent.BuildDirectory)/repos/${{parameters.resource_name }}
